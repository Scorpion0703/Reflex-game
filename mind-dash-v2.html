<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mind Dash ‚Ä¢ V2</title>
<meta name="theme-color" content="#0f1220">

<style>
:root{ --bg:#0f1220; --panel:#151a2f; --muted:#9aa4b2; --ok:#2ecc71; --warn:#ffb020; --bad:#ff5c5c; --accent:#6ee7ff; }
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;background:radial-gradient(1300px 800px at 70% -10%, #1a1f3d 0%, var(--bg) 60%);color:#e8eef7;
  font:16px/1.45 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;display:flex;align-items:center;justify-content:center;padding:20px}
.app{width:min(980px,100%);background:linear-gradient(180deg,#171c34 0%,var(--panel) 100%);border:1px solid #1f2747;border-radius:18px;
  box-shadow:0 20px 60px rgba(0,0,0,.45);padding:18px;display:grid;gap:14px;grid-template-columns:340px 1fr;position:relative}
h1{margin:0 0 4px;font-size:28px} .sub{color:var(--muted)}
.pill{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid #2a3565;margin-left:8px;color:#b8c3d6}
.controls{display:grid;gap:10px} .row{display:flex;gap:10px;flex-wrap:wrap}
select,button,input[type="range"],input[type="text"]{appearance:none;border:1px solid #273157;background:#0f1430;color:#e8eef7;
  padding:10px 12px;border-radius:12px;font-weight:600;letter-spacing:.2px}
button.primary{background:linear-gradient(180deg,#1d2a67,#122055);border-color:#2c3c7c} button:disabled{opacity:.6;cursor:not-allowed}
.statgrid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.stat{background:#0f1430;border:1px solid #1f2747;padding:10px 12px;border-radius:12px} .stat b{display:block;font-size:18px;margin-bottom:2px}
.stage{grid-column:1/-1;position:relative;min-height:430px;border-radius:16px;border:1px dashed #26305a;background:#0e1227;
  overflow:hidden;display:grid;place-items:center}
#fx{position:absolute;inset:0;pointer-events:none;z-index:1}
.cardQ{z-index:2;display:grid;place-items:center;gap:12px;text-align:center}
.question{min-width:60%;padding:18px 22px;border-radius:14px;font-size:clamp(22px,4.2vmin,36px);background:#0f1430;border:1px solid #25315f;
  box-shadow:0 12px 40px rgba(0,0,0,.35)}
.timer{width:min(540px,90%);height:10px;background:#0b1130;border:1px solid #22305c;border-radius:999px;overflow:hidden;margin:6px auto 0}
.timer>div{height:100%;width:100%;background:linear-gradient(90deg,var(--ok),#65f0c0);transform-origin:left center;transform:scaleX(1);transition:transform .05s linear}
.actions{display:flex;gap:12px;justify-content:center}
.actionBtn{min-width:120px;padding:12px 16px;border-radius:12px;font-weight:800;font-size:18px;cursor:pointer;border:1px solid #2a3565;
  background:#111846;transition:transform .12s ease,background .2s} .actionBtn:active{transform:scale(.98)}
.true{background:#12381f;border-color:#1c5c33} .false{background:#3a1420;border-color:#6a2036}
#log{background:rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.08);padding:12px;border-radius:10px;height:170px;overflow:auto;
  font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:13px;color:#d1d9e6;backdrop-filter:blur(8px);box-shadow:inset 0 0 10px rgba(0,0,0,.2)}
.entry{display:flex;align-items:center;gap:8px;padding:4px 0;opacity:0;animation:fadeIn .25s forwards}
.entry .dot{width:8px;height:8px;border-radius:50%;background:#4dd2a7;box-shadow:0 0 8px #4dd2a7}
.entry.fail .dot{background:#ff6b6b;box-shadow:0 0 8px #ff6b6b}
.entry.info .dot{background:#6ee7ff;box-shadow:0 0 8px #6ee7ff}
.entry .time{color:#8ab4ff} @keyframes fadeIn{to{opacity:1}}
.settingsBtn{margin-left:8px;border-radius:12px}
dialog#settings{border:1px solid #2a3565;background:#0f1430;color:#e8eef7;border-radius:16px;padding:16px 16px 8px;width:min(520px,92vw)}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.rowline{display:flex;align-items:center;justify-content:space-between;gap:10px;background:#0b112b;border:1px solid #1f2747;padding:10px 12px;border-radius:12px}
.range{flex:1}
.shake{animation:shake .25s} @keyframes shake{10%{transform:translateX(-4px)}20%{transform:translateX(4px)}30%{-webkit-transform:translateX(-3px)}40%{transform:translateX(3px)}100%{transform:translateX(0)}}
.pink{color:#ff6ad5;font-weight:800}
</style>
</head>
<body>
  <div class="app" id="app">
    <div>
      <h1>Mind Dash <span class="pill">V2</span></h1>
      <div class="sub">Stimmt die Aussage? Entscheide schnell.</div>
      <div class="controls">
        <div class="row">
          <button id="startBtn" class="primary">Start</button>
          <button id="resetBtn">Reset</button>
          <button id="openSettings" class="settingsBtn">‚öôÔ∏è Einstellungen</button>
        </div>
        <div class="statgrid">
          <div class="stat"><b id="statRound">0/20</b><span>Runde</span></div>
          <div class="stat"><b id="statScore">0</b><span>Punkte</span></div>
          <div class="stat"><b id="statAvg">‚Äì</b><span>√ò Reaktion</span></div>
        </div>
        <div class="stat">
          <b>Log</b>
          <div id="log"></div>
        </div>
      </div>
    </div>

    <div class="stage" id="stage">
      <canvas id="fx"></canvas>
      <div class="cardQ">
        <div id="q" class="question">Bereit?</div>
        <div class="timer"><div id="bar"></div></div>
        <div class="actions">
          <button id="btnTrue"  class="actionBtn true">‚úÖ Stimmt</button>
          <button id="btnFalse" class="actionBtn false">‚ùå Falsch</button>
        </div>
        <div class="sub" id="hint">Tippe auf ‚úÖ oder ‚ùå ‚Äì du hast wenig Zeit!</div>
      </div>
    </div>
  </div>

  <!-- Einstellungen -->
  <dialog id="settings">
    <button id="closeSettings" class="settingsBtn" style="float:right">Schlie√üen ‚úñ</button>
    <h3>‚öôÔ∏è Einstellungen</h3>
    <div class="grid2">
      <div class="rowline"><span>Runden</span><select id="optRounds"><option>10</option><option selected>20</option><option>30</option></select></div>
      <div class="rowline"><span>Zeitschranke (ms)</span><input type="range" id="optTime" class="range" min="600" max="2000" value="1200"></div>
      <div class="rowline"><span>Sounds</span><label><input type="checkbox" id="optSound" checked> an</label></div>
      <div class="rowline"><span>Lautst√§rke</span><input type="range" id="optVol" class="range" min="0" max="100" value="65"></div>
      <div class="rowline"><span>Partikel</span><label><input type="checkbox" id="optFx" checked> an</label></div>
      <div class="rowline"><span>Partikel-Dichte</span><input type="range" id="optDensity" class="range" min="10" max="120" value="60"></div>
      <div class="rowline"><span class="pink" id="luckyBtn">Lucky üê±</span><span style="opacity:.6">tippen‚Ä¶</span></div>
    </div>
  </dialog>

<script>
(()=>{
// ===== Elements
const q = document.getElementById('q'), bar=document.getElementById('bar'), logEl=document.getElementById('log');
const btnT=document.getElementById('btnTrue'), btnF=document.getElementById('btnFalse');
const startBtn=document.getElementById('startBtn'), resetBtn=document.getElementById('resetBtn');
const statRound=document.getElementById('statRound'), statScore=document.getElementById('statScore'), statAvg=document.getElementById('statAvg');
const openSettings=document.getElementById('openSettings'), settingsDlg=document.getElementById('settings'), closeSettings=document.getElementById('closeSettings');
const optRounds=document.getElementById('optRounds'), optTime=document.getElementById('optTime'), optSound=document.getElementById('optSound');
const optVol=document.getElementById('optVol'), optFx=document.getElementById('optFx'), optDensity=document.getElementById('optDensity'), luckyBtn=document.getElementById('luckyBtn');
const fxC=document.getElementById('fx'), fx=fxC.getContext('2d'), stage=document.getElementById('stage');

// ===== State
const S={rounds:20, round:0, score:0, results:[], running:false, timeMs:1200, t0:0, timer:0, sound:true, vol:.65, fx:true, density:60, best:null};

// ===== Prefs
try{ Object.assign(S, JSON.parse(localStorage.getItem('md2')||'{}')); }catch{}
optRounds.value=String(S.rounds); optTime.value=String(S.timeMs); optSound.checked=S.sound; optVol.value=Math.round(S.vol*100);
optFx.checked=S.fx; optDensity.value=S.density;

function savePrefs(){ localStorage.setItem('md2', JSON.stringify({rounds:S.rounds,timeMs:S.timeMs,sound:S.sound,vol:S.vol,fx:S.fx,density:S.density})); }

// ===== Utils
const fmt=ms=>`${ms.toFixed(0)} ms`; const avg=a=>a.length?a.reduce((x,y)=>x+y,0)/a.length:0;
function addLog(t,cls=''){ const e=document.createElement('div'); e.className=`entry ${cls}`;
  e.innerHTML=`<span class="dot"></span><span class="time">[${new Date().toLocaleTimeString()}]</span><span>${t}</span>`;
  logEl.appendChild(e); logEl.scrollTop=logEl.scrollHeight; }
function pick(a){ return a[Math.floor(Math.random()*a.length)]; }
function ri(a,b){ return a+Math.floor(Math.random()*(b-a+1)); }

// ===== Questions (Pool + Generatoren)
const POOL=[
  {text:"5√ó4 = 20",isTrue:true},{text:"Montag kommt nach Mittwoch",isTrue:false},{text:"Gelb ist heller als Dunkelblau",isTrue:true},
  {text:"3 > 8",isTrue:false},{text:"Eine Katze hat 6 Beine",isTrue:false},{text:"Berlin ist die Hauptstadt von Deutschland",isTrue:true},
  {text:"1, 1, 2, 3, 5, ? ‚Üí 8",isTrue:true},{text:"Spinnen sind Insekten",isTrue:false},{text:"Eine Stunde hat 60 Minuten",isTrue:true},
  {text:"Der Eiffelturm steht in Rom",isTrue:false},{text:"Sommer ist meist w√§rmer als Winter",isTrue:true},{text:"Schnee ist normalerweise wei√ü",isTrue:true}
];
function genMath(){ const ops=["+","-","√ó"], a=ri(1,12), b=ri(1,12), op=pick(ops);
  const correct=op==="+"?a+b:op==="-"?a-b:a*b; const isTrue=Math.random()<0.6;
  let shown=isTrue?correct:correct+(Math.random()<.5?-1:1)*ri(1,3); if(!isTrue && shown===correct) shown++;
  return {text:`${a} ${op} ${b} = ${shown}`, isTrue}; }
function genFibo(){ const seq=pick([[1,1,2,3,5,8],[2,3,5,8,13,21]]); const last=seq[5];
  const isTrue=Math.random()<0.7; const shown=isTrue?last:last+(Math.random()<.5?-1:1)*ri(1,2);
  return {text:`${seq[0]}, ${seq[1]}, ${seq[2]}, ${seq[3]}, ${seq[4]}, ? ‚Üí ${shown}`, isTrue}; }
function genFact(){ const f=[["Der Nil ist ein Fluss",true],["Wasser kocht bei 50¬∞C (Meeresh√∂he)",false],
  ["Honig kann sehr lange haltbar sein",true],["Eine Minute hat 100 Sekunden",false],["Gold ist schwerer als Wasser",true]];
  const [text,isTrue]=pick(f); return {text,isTrue}; }
function genCompare(){ const c=[["7 > 4",true],["12 < 5",false],["0 ist gr√∂√üer als 1",false],["100 ‚â• 99",true]]; const [t,b]=pick(c); return {text:t,isTrue:b}; }
function makeStatement(){ const r=Math.random(); if(r<.35)return genMath(); if(r<.5)return genFibo(); if(r<.7)return genFact(); if(r<.8)return genCompare(); return pick(POOL); }

// ===== FX
function resizeFx(){ fxC.width=fxC.clientWidth; fxC.height=fxC.clientHeight; } new ResizeObserver(resizeFx).observe(fxC); resizeFx();
const P=[]; function burst(kind='hit'){ if(!S.fx)return; const rect=q.getBoundingClientRect(), s=fxC.getBoundingClientRect();
  const cx=rect.left+rect.width/2-s.left, cy=rect.top+rect.height/2-s.top, n=Math.round(S.density/4);
  const col=kind==='hit'?'#2ecc71':(kind==='fail'?'#ff5c5c':'#ffb020');
  for(let i=0;i<n;i++){ const a=Math.random()*Math.PI*2, sp=1+Math.random()*3; P.push({x:cx,y:cy,vx:Math.cos(a)*sp,vy:Math.sin(a)*sp,life:.9+Math.random()*.5,r:2+Math.random()*2,c:col}); } }
function loop(){ fx.clearRect(0,0,fxC.width,fxC.height); for(let i=P.length-1;i>=0;i--){ const p=P[i]; p.life-=.016; if(p.life<=0){P.splice(i,1);continue;}
  p.x+=p.vx; p.y+=p.vy; p.vy+=.03; fx.globalAlpha=Math.max(p.life,0); fx.beginPath(); fx.arc(p.x,p.y,p.r,0,Math.PI*2); fx.fillStyle=p.c; fx.fill(); }
  requestAnimationFrame(loop); } requestAnimationFrame(loop);

// ===== Sound
let AC=null; function sfx(t){ if(!S.sound) return; try{ if(!AC) AC=new (window.AudioContext||window.webkitAudioContext)();
  const g=AC.createGain(), o=AC.createOscillator(); o.connect(g); g.connect(AC.destination); const T=AC.currentTime, V=S.vol;
  function env(p=.15,d=.12){ g.gain.setValueAtTime(.0001,T); g.gain.exponentialRampToValueAtTime(p*V,T+.02); g.gain.exponentialRampToValueAtTime(.0001,T+.02+d); }
  if(t==='ready'){o.type='triangle';o.frequency.setValueAtTime(740,T);env(.12,.12);}
  if(t==='hit'){o.type='square';o.frequency.setValueAtTime(560,T);o.frequency.exponentialRampToValueAtTime(1200,T+.12);env(.18,.2);}
  if(t==='fail'){o.type='sawtooth';o.frequency.setValueAtTime(260,T);o.frequency.exponentialRampToValueAtTime(120,T+.2);env(.22,.25);}
  if(t==='start'){o.type='sine';o.frequency.setValueAtTime(440,T);env(.15,.14);}
  o.start(); o.stop(T+.35);}catch{} }

// ===== Game flow
function updateStats(){ statRound.textContent=`${Math.min(S.round,S.rounds)}/${S.rounds}`; statScore.textContent=S.score; statAvg.textContent=S.results.length?fmt(avg(S.results)):'‚Äì'; }
function start(){ S.round=0;S.score=0;S.results=[];S.running=true; addLog(`Start ‚Ä¢ Runden: ${S.rounds} ‚Ä¢ Limit: ${S.timeMs}ms`,'info'); sfx('start'); next(); }
function next(){ if(S.round>=S.rounds){ finish(); return; } S.round++; updateStats(); const st=makeStatement(); q.textContent=st.text; sfx('ready');
  const t0=performance.now(); S.t0=t0; bar.style.transform='scaleX(1)'; function tick(){ const dt=performance.now()-t0, f=Math.max(0,1-dt/S.timeMs);
    bar.style.transform=`scaleX(${f})`; if(dt>=S.timeMs){ tooLate(); } else { S.timer=requestAnimationFrame(tick); } } tick();
  btnT.onclick=()=> respond(true,st); btnF.onclick=()=> respond(false,st); }
function respond(choice, st){ cancelAnimationFrame(S.timer); const rt=performance.now()-S.t0; const ok=(choice===st.isTrue);
  if(ok){ S.score++; S.results.push(rt); addLog(`‚úî Richtig ‚Ä¢ ${fmt(rt)}`); sfx('hit'); burst('hit'); } else { if(S.score>0) S.score--; addLog('‚úñ Falsch','fail'); sfx('fail'); burst('fail'); stage.classList.add('shake'); setTimeout(()=>stage.classList.remove('shake'),250); }
  updateStats(); setTimeout(next, 600); }
function tooLate(){ addLog('‚è≥ Zeit abgelaufen','fail'); sfx('fail'); burst('fail'); stage.classList.add('shake'); setTimeout(()=>stage.classList.remove('shake'),250); updateStats(); setTimeout(next,600); }
function finish(){ S.running=false; addLog(`Ende ‚Ä¢ Score ${S.score} ‚Ä¢ √ò ${S.results.length?fmt(avg(S.results)):'‚Äì'}`,'info'); q.textContent='Fertig'; }

// ===== UI
startBtn.onclick=()=>{ if(!S.running) start(); };
resetBtn.onclick=()=>{ cancelAnimationFrame(S.timer); S.round=0;S.score=0;S.results=[];S.running=false; bar.style.transform='scaleX(1)'; q.textContent='Bereit?'; logEl.innerHTML=''; updateStats(); };

openSettings.onclick=()=>settingsDlg.showModal(); closeSettings.onclick=()=>settingsDlg.close();
optRounds.onchange=()=>{ S.rounds=Number(optRounds.value); savePrefs(); };
optTime.oninput=()=>{ S.timeMs=Number(optTime.value); savePrefs(); };
optSound.onchange=()=>{ S.sound=optSound.checked; savePrefs(); };
optVol.oninput=()=>{ S.vol=Number(optVol.value)/100; savePrefs(); };
optFx.onchange=()=>{ S.fx=optFx.checked; savePrefs(); };
optDensity.oninput=()=>{ S.density=Number(optDensity.value); savePrefs(); };

// ===== Easter Egg: Lucky üê±
let luckyHits=0;
luckyBtn.addEventListener('click',()=>{ luckyHits++;
  addLog('‚ú® Lucky üê± ‚Äì Viel Gl√ºck f√ºr die n√§chste Runde!','info'); burst('hit');
  document.body.animate([{filter:'hue-rotate(0deg)'},{filter:'hue-rotate(25deg)'},{filter:'hue-rotate(0deg)'}],{duration:600});
  // Bonus: n√§chste richtige Antwort z√§hlt doppelt (einmalig)
  if(luckyHits<=3){ const oldRespond=respond; respond=function(choice,st){ const before=S.score; oldRespond(choice,st);
    if(S.score>before){ S.score++; addLog('üçÄ Lucky Bonus +1'); updateStats(); } respond=oldRespond; }; }
});

updateStats();
})();
</script>
</body>
</html>
